<!--
Copyright (C) 2012 Braden Walters

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU Affero General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU Affero General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->

{% load i18n %}

<!DOCTYPE html>
<html>
  <head>
    <title>Karteikarten System - Study</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}default/style.css" />
    <script type="text/javascript" src="{{ STATIC_URL }}common/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}common/database.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}common/studylogic.js"></script>

    <script type="text/javascript">
      //<![CDATA[
      var SITE_ROOT = '{{ site_root }}';
      var CSRF_TOKEN = '{{ csrf_token }}';

      var study_options =
        {% autoescape off %}{{ study_options }}{% endautoescape %};
      var study_logic = null;
      var current_card = null;

      $(document).ready(function()
        {
          var database = new Database(false, function(database)
            {
              study_logic = new StudyLogic(study_options, database, function()
                {
                  $('#study_mode').text(study_options.study_type_name);
                  $('#card_set_name').text(study_options.set_name);
                  displayNextCard();
                }, function(type, message)
                {
                })
            }, function(type, message)
            {
              alert(message);
            });
        });

      function displayNextCard()
      {
        flipCard('loading');
        study_logic.GetNextCard(function(card)
          {
            if (card == null)
            {
              finish();
              return;
            }
            current_card = card;
            $('#card_front_text').html(card.front);
            $('#card_back_text').html(card.back);

            var study_information = study_logic.GetStudyInformation();
            $('#card_box_name').text(study_information.box_name);
            $('#num_completed_cards').text(
              study_information.reviewed_cards_this_box);
            $('#num_total_cards').text(study_information.total_cards_this_box);
            flipCard('hide');
          }, function(type, message)
          {
            alert(message);
          });
      }

      function flipCard(visibility)
      {
        if (visibility == 'show')
        {
          $('#back').show();
          $('#back_content').show();
          $('#buttons').show();
          $('#practice_sidebar_content').show();
          $('#practice_sidebar_loading').hide();
          $('#card_front_text').show();
          $('#card_front_loading').hide();
        }
        else if (visibility == 'hide')
        {
          $('#back').show();
          $('#back_content').hide();
          $('#buttons').hide();
          $('#practice_sidebar_content').show();
          $('#practice_sidebar_loading').hide();
          $('#card_front_text').show();
          $('#card_front_loading').hide();
        }
        else //visibility == 'loading'
        {
          $('#back').hide();
          $('#practice_sidebar_loading').show();
          $('#practice_sidebar_content').hide();
          $('#card_front_loading').show();
          $('#card_front_text').hide();
        }
      }

      function correct()
      {
        flipCard('loading');
        study_logic.Correct(current_card.id, displayNextCard,
          function(type, message)
          {
            alert(message);
          });
      }

      function incorrect()
      {
        flipCard('loading');
        study_logic.Incorrect(current_card.id, displayNextCard,
          function(type, message)
          {
            alert(message);
          });
      }

      function finish()
      {
        window.location.href = '{% url run-finished %}';
      }
      //]]>
    </script>
  </head>
  <body>
    <div style="position: absolute; top: 5px; left: 5px; text-align: center; font-size: 10px;">
      <img src="{{ STATIC_URL }}common/karteikarten.png" alt="Karteikartensystem" /><br />
      {% include "version.html" %}
    </div>
    <div id="study" style="margin-left: auto; margin-right: auto; width: 600px; text-align: center;">
      <div class="practice_sidebar">
        <div id="practice_sidebar_content">
          <b>{% trans "study-mode" %}:</b><br />
          <span id="study_mode"></span><br /><br />
          <b>{% trans "current-set" %}:</b><br />
          <span id="card_set_name"></span><br /><br />
          <b>{% trans "current-box" %}:</b><br />
          <span id="card_box_name"></span><br /><br />
          <b>{% trans "cards" %}<span id="in_this_box"> ({% trans "in-this-box" %})</span>:</b><br />
          <span id="num_completed_cards"></span> / <span id="num_total_cards"></span>
          <div id="finish">
            <br />
            <a href="{% url run-finished %}" class="button" style="background-color: #ffffff;" >{% trans "finish" %}</a>
          </div>
        </div>
        <div id="practice_sidebar_loading">
          {% trans "loading" %}...
        </div>
      </div>
      <div id="front" class="card">
        <table class="card_content">
          <tr>
            <td>
              <span id="card_front_text">
              </span>
              <img id="card_front_loading" style="display: none;" src="{{ STATIC_URL }}default/ajax-loader.gif" alt="{% trans "loading" %}..." />
            </td>
          <tr>
        </table>
      </div>
      <div id="back" class="card_not_visible">
        <a href="javascript:flipCard('show');" style="display: block;">
          <table class="card_content">
            <tr>
              <td>
                {% trans "click-to-flip-card" %}
              </td>
            <tr>
          </table>
        </a>

        <table id="back_content" class="card_content" style="float: left; background-color: #ffffff; display: none;">
          <tr>
            <td id="card_back_text">
            </td>
          <tr>
        </table>
      </div>
      <div id="buttons" class="non_card" style="display: none;">
        <a href="javascript:correct();" class="button" style="background-color: #00a000;">
          {% trans "correct" %}
        </a>
        <a href="javascript:incorrect();" class="button" style="background-color: #a00000;">
          {% trans "incorrect" %}
        </a>
      </div>
    </div>
  </body>
</html>
